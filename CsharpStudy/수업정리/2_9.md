# 📌 C# 개발 품질 향상을 위한 테스트 및 아키텍처 전략

---

## ✨ Executive Summary

- 소프트웨어 개발의 **완성 = 기능 구현 + 품질 확보**
- 핵심 전략
    1. **테스트 이론 & 실제 적용**
    2. **아키텍처 패턴(모델 & 리포지토리) 활용**
- 효과: 버그 조기 발견, 리팩토링 자신감, 장기적인 안정성 & 속도 확보

---

## 1️⃣ 소프트웨어 테스트 전략

### ✔ 개발 ‘완성’의 재정의

- ❌ 잘못된 기준: 기능 절반 = 개발 절반 완료
- ✅ 올바른 기준: 품질까지 포함 → 테스트 & 리팩토링이 전체의 큰 비중 차지

### ✔ 테스트 종류

| 종류 | 설명 | 예시 |
| --- | --- | --- |
| 수동 테스트 | 직접 실행 후 확인 | `print` 출력 확인 |
| 단위 테스트(Unit) | 가장 작은 모듈 단위 검증 | 메서드 테스트 코드 |
| 통합 테스트(Integration) | 여러 모듈/시스템 조합 검증 | UI, 시스템 통합 |

### ✔ 테스트 기법

- **화이트박스**: 내부 구조 검증 (구문/경로/분기 검사)
- **블랙박스**: 입력·출력 기반, 사용자 관점 (동등 분할, 경곗값 분석)

### ✔ 단위 테스트

- 장점: 빠른 피드백, 조기 장애 감지, 안전한 리팩토링, 안정적 개발 속도
- 기법: 동등 분할, 경곗값 분석
- 필수 상황: DB 변경, 네트워크 처리, 데이터 검증

### ✔ TDD (Test Driven Development)

1. 실패하는 테스트 작성
2. 코드 구현 → 테스트 통과
3. 리팩토링

---

## 2️⃣ 테스트 가능한 구조 설계

### ✔ 테스트가 어려운 구조

- 강한 결합 (new로 직접 생성) → 외부 의존성 때문에 테스트 불가

### ✔ 해결책 1: 테스트 더블

- **Dummy**: 전달만, 사용 X
- **Stub**: 고정 응답 반환
- **Spy**: Stub + 호출 기록
- **Mock**: 호출 행위 검증
- **Fake**: 단순 구현 (ex. 인메모리 DB)

### ✔ 해결책 2: 의존성 주입(DI) & 인터페이스

- 추상화 인터페이스에 의존
- 외부에서 의존 객체 주입 (생성자, 메서드)
- → 실제 환경에서는 실 구현체, 테스트 환경에서는 Mock 사용

```csharp
// Before (직접 생성 → 테스트 어려움)
public class TodoRepositoryImpl {
    private readonly IDataSource _dataSource = new DataSource();
}

// After (DI 적용 → 테스트 용이)
public class TodoRepositoryImpl {
    private readonly IDataSource _dataSource;
    public TodoRepositoryImpl(IDataSource dataSource) {
        _dataSource = dataSource;
    }
}

```

### ✔ 좋은 단위 테스트 조건 (FRIEND)

- **F**ast
- **R**eliable
- **I**ndependent
- **E**asy to maintain
- **N**early compact
- **D**ependencies less

---

## 3️⃣ 아키텍처: 모델 & 리포지토리 패턴

### ✔ 모델(Model)

- 정의: 데이터를 담는 객체 (Data Holder)
- 역할: 데이터 구조 정의, 직렬화/역직렬화
- 이상적: 순수한 불변 객체

### ✔ 리포지토리(Repository)

- 정의: 데이터 소스 접근을 추상화·캡슐화
- 목표: 비즈니스 로직 ↔ 데이터 소스 분리
- 역할:
    - 데이터 접근 진입점
    - 데이터 소스 은닉
    - 데이터 매핑/변환
    - 도메인 특화 쿼리 제공

### ✔ 이점

- 관심사 분리 (ex. `InventoryRepository`)
- 테스트 용이성 (Mock 활용)
- 확장성 (로컬 ↔ 클라우드 교체 용이)

### ✔ 데이터 소스 vs 리포지토리

- **DataSource**: 실제 데이터 CRUD (파일, DB, API)
- **Repository**: 도메인 관점 데이터 제공, DataSource 조합

### ✔ 권장 폴더 구조

```
/Models
  - Item.cs
/Data
  /Repositories
    - IInventoryRepository.cs
    - InventoryRepository.cs
  /DataSources
    - IItemDataSource.cs
    - JsonFileItemDataSource.cs

```